frappe.ready(function () {
    frappe.call({
        method: 'frappe.client.get_list',
        args: {
            doctype: 'Compliancetracker',
            fields: ['*'],
        },
        callback: function (response) {
            if (response.message) {
                const complianceNames = response.message.map(item => item.name);
                populateTableWithComplianceNames(complianceNames);
            }
        },
    });

    frappe.call({
        method: 'frappe.client.get_list',
        args: {
            doctype: 'User',
            fields: ['full_name'],
        },
        callback: function (response) {
            if (response.message) {
                const userNames = response.message.map(item => item.full_name);
                populateDropdownsInTable(userNames);
            }
        },
    });
});

function populateTableWithComplianceNames(complianceNames) {
    const tableBody = document.querySelector('#complianceTable tbody');
    complianceNames.forEach(name => {
        const row = tableBody.insertRow();
        const cell1 = row.insertCell(0);
        cell1.textContent = name;
        const cell2 = row.insertCell(1);
        const userDropdown = createUserDropdown();
        cell2.appendChild(userDropdown);
    });
}

function createUserDropdown() {
    const dropdown = document.createElement('select');
    dropdown.className = 'form-control';
    return dropdown;
}

function populateDropdownsInTable(userNames) {
    const dropdowns = document.querySelectorAll('#complianceTable select');
    dropdowns.forEach(dropdown => {
        userNames.forEach(userName => {
            const option = document.createElement('option');
            option.value = userName;
            option.textContent = userName;
            dropdown.appendChild(option);
        });
    });
}

document.addEventListener("DOMContentLoaded", function() {
    var saveButton = document.getElementById("save-button");
    saveButton.addEventListener("click", function() {
        frappe.call({
            method: 'your_custom_method_name',
            // You can specify additional arguments or data as needed
            args: {
                // Add any data you want to pass to the server-side method
            },
            callback: function(response) {
                // Handle the response from the server-side method here
                if (response.message) {
                    // Do something with the response data
                }
            }
        });
    });
});
